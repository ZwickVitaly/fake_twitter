# Fake Twitter
### Пет-проект

### 1. Зачем:
Понять как работают библиотеки FastAPI, SQLAlchemy, Pytest \
А также такие инструменты как Docker, Nginx и Uvicorn

### 2. Запуск:
#### Перед запуском необходимо установить docker.
Можно и без него, но в таком случае для подключение к базе данных 
(приложение ориентировано на PostgreSQL с драйверами для асинхронной работы)
небходимо будет переопределить в файле fake_twitter/app/config.py \
Тесты и Nginx тоже рассчитаны под docker.

\
Перед запуском необходимо задать переменные окружения. Например в файле .env-template а после переименовать файл в .env
- USER - [необязательно] логин администратора для создания\удаления пользователей. Если не будет указан - будет взят из системы (переменная USER). Если не будет найдена переменная - по умолчанию: admin
- ADMIN_PASSWORD - пароль администратора для создания\удаления пользователей. Если не будет указан - по умолчанию: admin
- API_KEYWORD -  [необязательно] название хедера, необходимого для аутентификации. По умолчанию - "api-key" 
- POSTGRES_USER - [обязательно] логин администратора для базы данных. 
###### Без указания этой переменной в файле .env или в окружении база данных не запустится -> не запустится всё приложение.
- POSTGRES_PASSWORD - [обязательно] пароль администратора для базы данных. 
###### Без указания этой переменной в файле .env или в окружении база данных не запустится -> не запустится всё приложение.


### 3. Эндпоинты
##### Все эндпоинты указаны без учёта url хоста.
##### Идентификация пользователя происходит по заголовку(header), указанному в значении переменной API_KEYWORD (см выше)

- /api/users/me (GET) : получить информацию о текущем пользователе.
- /api/users/{user_id : int} (GET) - получить информацию о пользователе по его id.
- /api/users/{user_id : int}/follow (POST) : добавить пользователя в отслеживаемые по его id
- /api/users/{user_id : int}/follow (DELETE) : убрать пользователя из отслеживаемых по его id
- /api/tweets (GET) : - получить список всех твитов, отсортированных по дате создания в обратном порядке(сначала последние)
- /api/tweets (POST) : - запостить новый твит. ВАЖНЫЙ МОМЕНТ. 
Если необходимо запостить твит с фото - фото перед запросом необходимо загрузить на /api/medias (см. ниже)
- /api/tweets/{tweet_id : int} (GET) : получить информацию о твите
- /api/tweets/{tweet_id : int} (DELETE) : удалить твит
- /api/tweets/{tweet_id : int}/likes (POST) : лайкнуть твит
- /api/tweets/{tweet_id : int}/likes (DELETE) : убрать лайк с твита
- /api/medias (POST) (form-data: file) : загрузить медиа файл для твита
#### После запуска интерактивная документация доступна по эндпоинту /docs
#### Также эндпоинты для создания/удаления пользователя (не указаны в интерактивной документации):

- /api/admin/user (POST) : создать пользователя
- /api/admin/user (DELETE) : удалить пользователя

Оба этих эндпоинта потребуют сообщение вида 
<pre>{
    "login": "USER",
    "password": "ADMIN_PASSWORD",
    "user_data":
    {"name": "new user name",
    "api_key": "api-key"
    }
}</pre>
USER и ADMIN_PASSWORD берутся из переменных окружения, указанных выше.
Имя и api_key пользователя должны быть уникальны. Для api_key рекомендуется использовать
uuid4 или uuid7 для повышения энтропии(рандомности)

### 4. Фронтенд
В проекте присутствует сторонний фронтенд для демонстрации. Необходимо создать пользователя
<pre>
{
    "name" : string,
    "api_key": "test"
}
</pre>
Без этого пользователя даже при наличии других пользователей фронтенд не запустится.
